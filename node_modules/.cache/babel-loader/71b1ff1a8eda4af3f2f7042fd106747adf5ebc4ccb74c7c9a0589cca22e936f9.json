{"ast":null,"code":"import _slicedToArray from\"/Users/dootss/appdevelopment/blast/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{useParams,useLocation}from'react-router-dom';import{graphcms}from'../graphql/Queries';import{useMyContext}from'../context/store';var useQueryPosts=function useQueryPosts(_ref){var query=_ref.query,_ref$limit=_ref.limit,limit=_ref$limit===void 0?3:_ref$limit,_ref$main=_ref.main,main=_ref$main===void 0?false:_ref$main;var _useParams=useParams(),slug=_useParams.slug;var _useLocation=useLocation(),search=_useLocation.search,pathname=_useLocation.pathname;var page=Number(new URLSearchParams(search).get('page'))||1;var skip=(page-1)*limit;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),status=_useState6[0],setStatus=_useState6[1];var _useMyContext=useMyContext(),setLoading=_useMyContext.setLoading,setTotalPage=_useMyContext.setTotalPage;useEffect(function(){setTotalPage(1);},[pathname,setTotalPage]);useEffect(function(){setStatus('start');setLoading(true);if(slug||main){graphcms.request(query,{slug:slug,limit:limit,skip:skip}).then(function(res){var _res$countConnection,_res$countConnection$;setStatus('success');var count=(res===null||res===void 0?void 0:(_res$countConnection=res.countConnection)===null||_res$countConnection===void 0?void 0:(_res$countConnection$=_res$countConnection.aggregate)===null||_res$countConnection$===void 0?void 0:_res$countConnection$.count)||0;setTotalPage(Math.ceil(count/limit));setPosts(res.posts);setError(null);}).catch(function(error){setStatus('error');setTotalPage(1);setPosts([]);setError(error.message);}).finally(function(){return setLoading(false);});}else{setStatus('error');setPosts([]);setError(null);setLoading(false);}},[main,setLoading,setTotalPage,query,slug,limit,skip]);return{posts:posts,error:error,status:status};};export default useQueryPosts;","map":{"version":3,"names":["useState","useEffect","useParams","useLocation","graphcms","useMyContext","useQueryPosts","_ref","query","_ref$limit","limit","_ref$main","main","_useParams","slug","_useLocation","search","pathname","page","Number","URLSearchParams","get","skip","_useState","_useState2","_slicedToArray","posts","setPosts","_useState3","_useState4","error","setError","_useState5","_useState6","status","setStatus","_useMyContext","setLoading","setTotalPage","request","then","res","_res$countConnection","_res$countConnection$","count","countConnection","aggregate","Math","ceil","catch","message","finally"],"sources":["/Users/dootss/appdevelopment/blast/src/hooks/useQueryPosts.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useParams, useLocation } from 'react-router-dom';\nimport { graphcms } from '../graphql/Queries';\nimport { useMyContext } from '../context/store';\n\nconst useQueryPosts = ({query, limit = 3, main = false }) => {\n  const { slug } = useParams();\n  const { search, pathname } = useLocation();\n\n  const page = Number(new URLSearchParams(search).get('page')) || 1;\n  const skip = (page - 1) * limit;\n  const [posts, setPosts] = useState([]);\n  const [error, setError] = useState(null);\n  const [status, setStatus] = useState('');\n  \n  const { setLoading, setTotalPage } = useMyContext();\n\n  useEffect(() => {\n    setTotalPage(1);\n  }, [pathname, setTotalPage]);\n\n  useEffect(() => {\n    setStatus('start')\n    setLoading(true);\n    if(slug || main) {\n      graphcms.request(query, { slug, limit, skip })\n      .then(res => {\n        setStatus('success')\n        const count = res?.countConnection?.aggregate?.count || 0;\n        setTotalPage(Math.ceil(count / limit));\n        setPosts(res.posts);\n        setError(null);\n      })\n      .catch(error => {\n        setStatus('error')\n        setTotalPage(1);\n        setPosts([]);\n        setError(error.message);\n      })\n      .finally(() => setLoading(false))\n    } else {\n      setStatus('error');\n      setPosts([]);\n      setError(null);\n      setLoading(false);\n    }\n  }, [main, setLoading, setTotalPage, query, slug, limit, skip])\n\n  return { posts, error, status }\n}\n\nexport default useQueryPosts\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}